name: Google Scholar Crawler

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      GOOGLE_SCHOLAR_ID: ${{ secrets.GOOGLE_SCHOLAR_ID }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install scholarly

    - name: Check Google Scholar ID
      run: |
        echo "import os" > check_scholar_id.py
        echo "from scholarly import scholarly" >> check_scholar_id.py
        echo "def check_google_scholar_id(scholar_id):" >> check_scholar_id.py
        echo "    try:" >> check_scholar_id.py
        echo "        author = scholarly.search_author_id(scholar_id)" >> check_scholar_id.py
        echo "        if author:" >> check_scholar_id.py
        echo "            print(f'Google Scholar ID is valid.')" >> check_scholar_id.py
        echo "            print(f'Author Name: {author['name']}')" >> check_scholar_id.py
        echo "            print(f'Affiliation: {author['affiliation']}')" >> check_scholar_id.py
        echo "        else:" >> check_scholar_id.py
        echo "            print('Google Scholar ID is not valid.')" >> check_scholar_id.py
        echo "    except Exception as e:" >> check_scholar_id.py
        echo "        print(f'An error occurred: {e}')" >> check_scholar_id.py
        echo "" >> check_scholar_id.py
        echo "google_scholar_id = os.environ.get('GOOGLE_SCHOLAR_ID')" >> check_scholar_id.py
        echo "check_google_scholar_id(google_scholar_id)" >> check_scholar_id.py
        python3 check_scholar_id.py
